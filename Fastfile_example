default_platform :ios

platform :ios do
  before_all do
    # store all output in the Jenkins workspace
    # result_bundle: false works around a fastlane bug where run_tests can't find the test results to pass to trainer
    setup_jenkins result_bundle: false
  end

  lane :build_tests do
    run_tests scheme: 'Tests', device: 'iPhone 14', build_for_testing: true, output_types: ''
  end

  lane :test do
    scheme_name = 'Tests'
    run_tests scheme: scheme_name, device: 'iPhone 14', test_without_building: true, output_types: '', fail_build: false

  end

  desc 'Build and sign for testflight'
  lane :build do |opts|
    opts[:config] ||= 'Distribution'

    build_app scheme: 'MyApp', configuration: opts[:config], export_xcargs: '-allowProvisioningUpdates'
  end
end